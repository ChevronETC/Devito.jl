<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Devito.jl · Devito</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Devito</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Devito.jl</a><ul class="internal"><li><a class="tocitem" href="#Construction-of-a-Devito-stencil"><span>Construction of a Devito stencil</span></a></li><li><a class="tocitem" href="#Data-access"><span>Data access</span></a></li></ul></li><li><a class="tocitem" href="reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Devito.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Devito.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ChevronETC/Devito.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Devito.jl"><a class="docs-heading-anchor" href="#Devito.jl">Devito.jl</a><a id="Devito.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Devito.jl" title="Permalink"></a></h1><p>This is a Julia API for Devito.  it provides a Julia API&#39;s for a sub-set of Devito, supporting <code>Grid</code>&#39;s, <code>Function</code>&#39;s, <code>TimeFunction</code>&#39;s and <code>SparseTimeFunction</code>&#39;s for both their serial and domain decomposed MPI variants.</p><h2 id="Construction-of-a-Devito-stencil"><a class="docs-heading-anchor" href="#Construction-of-a-Devito-stencil">Construction of a Devito stencil</a><a id="Construction-of-a-Devito-stencil-1"></a><a class="docs-heading-anchor-permalink" href="#Construction-of-a-Devito-stencil" title="Permalink"></a></h2><p>The procedure for constructing a stencil operator consists of five parts:</p><ol><li>Construction of a Grid object containing grid size and spacing information on which the stencil will operate</li><li>Construction of TimeFunction or Function objects that hold the actual arrays on which the stencil will operate</li><li>Construction of SparseTimeFunction objects that hold source and receiver data for injection and retrieval during the stencil operation</li><li>Construction of Eqn objects (equation objects) that specify the equations that the stencil operator will carry out</li><li>Construction of the operator object which generates the low level C code fo rthe stencil operator</li></ol><p>Following this the operator may be executed. An example of these five steps is detailed below</p><p>1. Definition of the Grid object</p><p>The <code>Grid</code> object is specified by initializing extent, spacing, and origin tuples in the constructor. Dimension objects contain the  abstract spacing variables used by SymPy in specifying abstract equations in the stencil definition</p><pre><code class="language-julia">dt=1.
shpe=(20,20)
spacing=(5.,5.)
origin=(0.,0.)
extent=(shpe.-1).*spacing
spacet=Constant(name=&quot;h_t&quot;, dt) 
t=TimeDimension(name=&quot;t&quot;,spacing=spacet)
spacex=Constant(name=&quot;h_x&quot;, spacing[1]) 
x=SpaceDimension(name=&quot;x&quot;,spacing=spacex)
spacez=Constant(name=&quot;h_z&quot;, spacing[2])
z=SpaceDimension(name=&quot;z&quot;,spacing=spacez)
grid=Grid(extent=extent, shape=shpe, origin=origin, dimensions=(x,z), time_dimension=t)</code></pre><p>Note that unlike with the Devito Python implementation, which is column-major, all tuples involving dimensions are passed in row-major ordering. This row-major ordering convention is consistent throughout Devito.jl</p><p>2. Construction of time and space functions</p><p>Parameters on the grid are specified using Function objects, while time dependent fields are specified using TimeFunction objects,  as in this 2D elastic example:</p><pre><code class="language-julia">so=4
bx=Devito.Function(name= &quot;bx&quot; ,grid=grid, staggered=x,     space_order=so)
bz=Devito.Function(name= &quot;bz&quot; ,grid=grid, staggered=z,     space_order=so)
c11=Devito.Function(name=&quot;c11&quot;,grid=grid, space_order=so)
c33=Devito.Function(name=&quot;c33&quot;,grid=grid, space_order=so)
c55=Devito.Function(name=&quot;c55&quot;,grid=grid, staggered=(x,z), space_order=so)
c13=Devito.Function(name=&quot;c13&quot;,grid=grid, space_order=so)
data(bx).=mp[:,:,1]
data(bz).=mp[:,:,2]
data(c11).=mp[:,:,3]
data(c33).=mu[:,:,2]
data(c55).=mp[:,:,4]
data(c13).=mp[:,:,5]
vx=TimeFunction(name=&quot;vx&quot;,      grid=grid,space_order=so, staggered=x, time_order=1)
vz=TimeFunction(name=&quot;vz&quot;,      grid=grid,space_order=so, staggered=z, time_order=1)
tauxx=TimeFunction(name=&quot;tauxx&quot;,grid=grid,space_order=so,                  time_order=1)
tauzz=TimeFunction(name=&quot;tauzz&quot;,grid=grid,space_order=so,                  time_order=1)
tauxz=TimeFunction(name=&quot;tauxz&quot;,grid=grid,space_order=so, staggered=(x,z), time_order=1)</code></pre><p>In this example, the <code>data()</code> function returns a view to the Function&#39;s internal data, which is then initialized from an externally defined arrays mp and mu.</p><p>3. Construction of  SparseTimeFunctions</p><p><code>SparseTimeFunctions</code> are used to inject source and retrieve receiver information during the stencil operations</p><pre><code class="language-julia">src = SparseTimeFunction(name=&quot;src&quot;, grid=grid, npoint=1, nt=nt)
src_coords = coordinates(src)
src_coords .= [625.0; 5.0]
src_data = data(src)
src_data.= ricker(nt,dt,f0)
src_term = inject(src; field=forward(tauxx), expr=src)</code></pre><p>In this example, the source is created with an external function <code>ricker()</code>, which is then used to initialize the SparseTimeFunction data that will be injected into the time function <code>forward(tauxx)</code></p><p>4. Construction of  stencil equations</p><p>Stencil equations are created using the Eqn constructor </p><pre><code class="language-julia">eqvx = Eq(forward(vx), vx + dt*bx*dx(tauxx) + dt*bx*dz(tauxz, x0=z) - dt*damp*vx)
eqvz = Eq(forward(vz), vz + dt*bz*dx(tauxz, x0=x) + dt*bz*dz(tauzz) - dt*damp*vz)</code></pre><p>In this particular fragment from an elastic 2D example, damp is an externally defined array for damping at the boundaries, vx and vz are particle velocities, and the tau variables are the stresses </p><p>5. Construction of the operator</p><p>Construction of the operator requires a list containing all objects created using the <code>inject()</code>, <code>interpolate()</code>, and <code>Eq()</code> functions:</p><pre><code class="language-julia">op=Operator(op_list, subs=spacing_map(grid))
apply(op)</code></pre><p>where op_list contains the objects comprising the stencil.</p><h2 id="Data-access"><a class="docs-heading-anchor" href="#Data-access">Data access</a><a id="Data-access-1"></a><a class="docs-heading-anchor-permalink" href="#Data-access" title="Permalink"></a></h2><p>Devito.jl provides a Julia array interface for convenient and fast (copy-free) access to the Devito numpy arrays.  For example,</p><pre><code class="language-julia">using Devito

configuration!(&quot;language&quot;, &quot;openmpi&quot;)
configuration!(&quot;mpi&quot;, false)

configuration() # show the Devito configuration

g = Grid(shape=(10,20,30))
f = Devito.Function(name=&quot;f&quot;, grid=g, space_order=8)
d = data(f)
d_with_halo = data_with_halo(f)
d_with_inhalo = data_with_inhalo(f)</code></pre><p>In the above code listing:</p><ul><li><code>d</code> is a view of the underlying numpy array that excludes Devito&#39;s exterior and interior halo padding</li><li><code>d_with_halo</code> is a view that includes Devito&#39;s exterior halo padding, but excludes its interior halo padding</li><li><code>d_with_inhalo</code> is a view that includes Divito&#39;s exterior and interior halo padding</li></ul><p>If we are running with MPI turned on, then the <code>data</code>, <code>data_with_halo</code> and <code>data_with_inhalo</code> methods return a view to an MPI domain distributed array.  This array can be gathered to the rank 0 MPI rank with the convert method:</p><pre><code class="language-julia">using Devito

configuration!(&quot;language&quot;, &quot;openmpi&quot;)
configuration!(&quot;mpi&quot;, true)

g = Grid(shape=(10,20,30))
f = Devito.Function(name=&quot;f&quot;, grid=g, space_order=8)
d = data(f)
p = parent(d) # array local to this MPI rank
_d = convert(Array, d) # _d is an Array on MPI rank 0 gathered from `d` which is decomposed accross all MPI ranks</code></pre><p>Please see the <code>demo</code> folder in this package for more details.</p><p>In general, the wrapping of Devito functionality uses the same function and argument names as in the original Python implementation, with  python class members being accessed in Julia through functions having the same name as the member, and taking the class object as the first argument. For more details, please refer to the Devito website https://github.com/devitocodes/devito.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 13 May 2022 16:39">Friday 13 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
