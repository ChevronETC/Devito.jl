<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Devito.jl · Devito</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Devito</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Devito.jl</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Devito.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Devito.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ChevronETC/Devito.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Devito.jl"><a class="docs-heading-anchor" href="#Devito.jl">Devito.jl</a><a id="Devito.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Devito.jl" title="Permalink"></a></h1><p>Package Devito is a Julia wrapper for the Devito stencil compiler. The procedure for constructing a stencil operator consists of five parts:</p><ol><li>Construction of a Grid object containing grid size and spacing information on which the stencil will operate</li><li>Construction of TimeFunction or Function objects that hold the actual arrays on which the stencil will operate</li><li>Construction of SparseTimeFunction objects that hold source and receiver data for injection and retrieval during the stencil operation</li><li>Construction of Eqn objects (equation objects) that specify the equations that the stencil operator will carry out</li><li>Construction of the operator object which generates the low level C code fo rthe stencil operator</li></ol><p>Following this the operator may be executed. An example of these five steps is detailed below</p><ol><li>Definition of the Grid object</li></ol><p>The <code>Grid</code> object is specified by initializing extent, spacing, and origin tuples in the constructor. Dimension objects contain the  abstract spacing variables used by SymPy in specifying abstract equations in the stencil definition</p><pre><code class="language-julia">dt=1.
shpe=(20,20)
spacing=(5.,5.)
origin=(0.,0.)
extent=(shpe.-1).*spacing
spacet=Constant(name=&quot;h_t&quot;, dt) 
t=TimeDimension(name=&quot;t&quot;,spacing=spacet)
spacex=Constant(name=&quot;h_x&quot;, spacing[1]) 
x=SpaceDimension(name=&quot;x&quot;,spacing=spacex)
spacez=Constant(name=&quot;h_z&quot;, spacing[2])
z=SpaceDimension(name=&quot;z&quot;,spacing=spacez)
grid=Grid(extent=extent, shape=shpe, origin=origin, dimensions=(x,z), time_dimension=t)</code></pre><p>Note that he dimensions are passed in column-major order, in alignment with the Devito Python implementation. For all other tuples involving dimensions in Julia, the ordering is row-major.</p><ol><li>Construction of time and space functions</li></ol><p>Parameters on the grid are specified using Function objects, while time dependent fields are specified using TimeFunction objects,  as in this 2D elastic example:</p><pre><code class="language-julia">so=4
bx=Devito.Function(name= &quot;bx&quot; ,grid=grid, staggered=x,     space_order=so)
bz=Devito.Function(name= &quot;bz&quot; ,grid=grid, staggered=z,     space_order=so)
c11=Devito.Function(name=&quot;c11&quot;,grid=grid, space_order=so)
c33=Devito.Function(name=&quot;c33&quot;,grid=grid, space_order=so)
c55=Devito.Function(name=&quot;c55&quot;,grid=grid, staggered=(x,z), space_order=so)
c13=Devito.Function(name=&quot;c13&quot;,grid=grid, space_order=so)
data(bx).=mp[:,:,1]
data(bz).=mp[:,:,2]
data(c11).=mp[:,:,3]
data(c33).=mu[:,:,2]
data(c55).=mp[:,:,4]
data(c13).=mp[:,:,5]
vx=TimeFunction(name=&quot;vx&quot;,      grid=grid,space_order=so, staggered=x, time_order=1)
vz=TimeFunction(name=&quot;vz&quot;,      grid=grid,space_order=so, staggered=z, time_order=1)
tauxx=TimeFunction(name=&quot;tauxx&quot;,grid=grid,space_order=so,                  time_order=1)
tauzz=TimeFunction(name=&quot;tauzz&quot;,grid=grid,space_order=so,                  time_order=1)
tauxz=TimeFunction(name=&quot;tauxz&quot;,grid=grid,space_order=so, staggered=(x,z), time_order=1)</code></pre><p>In this example, the <code>data()</code> function returns a view to the Function&#39;s internal data, which is then initialized from an externally defined arrays mp and mu.</p><ol><li>Construction of  SparseTimeFunctions</li></ol><p><code>SparseTimeFunctions</code> are used to inject source and retrieve receiver information during the stencil operations</p><pre><code class="language-julia">src = SparseTimeFunction(name=&quot;src&quot;, grid=grid, npoint=1, nt=nt)
src_coords = coordinates(src)
src_coords .= [625.0; 5.0]
src_data = data(src)
src_data.= ricker(nt,dt,f0)
src_term = inject(src; field=forward(tauxx), expr=src)</code></pre><p>In this example, the source is created with an external function <code>ricker()</code>, which is then used to initialize the SparseTimeFunction data that will be injected into the time function <code>forward(tauxx)</code></p><ol><li>Construction of  stencil equations</li></ol><p>Stencil equations are created using the Eqn constructor </p><pre><code class="language-julia">eqvx = Eq(forward(vx), vx + dt*bx*dx(tauxx) + dt*bx*dz(tauxz, x0=z) - dt*damp*vx)
eqvz = Eq(forward(vz), vz + dt*bz*dx(tauxz, x0=x) + dt*bz*dz(tauzz) - dt*damp*vz)</code></pre><p>In this particular fragment from an elastic 2D example, damp is an externally defined array for damping at the boundaries, vx and vz are particle velocities, and the tau variables are the stresses </p><ol><li>Construction of the operator</li></ol><p>Construction of the operator requires a list containing all objects created using the <code>inject()</code>, <code>interpolate()</code>, and <code>Eq()</code> functions:</p><pre><code class="language-julia">op=Operator(op_list, subs=spacing_map(grid))
apply(op)</code></pre><p>where op_list contains the objects comprising the stencil.</p><p>In general, the wrapping of Devito functionality uses the same function and argument names as in the original Python implementation, with  python class members being accessed in Julia through functions having the same name as the member, and taking the class object as the first argument.</p><p>For more details, please refer to the Devito website https://github.com/devitocodes/devito</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 17 September 2020 19:19">Thursday 17 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
